<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Real-time Data Processing with Apache Kafka, Spark Streaming and Scala</title>
	
	<meta name="description" content="Practicle guide to connect Apache Kafka with Apache Spark using Scala, for real-time processing.">
	
	<meta name="author" content="Omal Perera">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="shortcut icon" href="/assets/ico/favicon.ico">

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/OmalPerera">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/OmalPerera">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:omalperera8@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="//www.gravatar.com/avatar/f29579eebcf0cb079c43eb37c7123235?s=35" class="img-circle" />
				Omal Perera
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs" style="">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="//www.gravatar.com/avatar/f29579eebcf0cb079c43eb37c7123235?s=150" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/">Omal Perera</a>
    </h3>
</header>


<div id="bio" class="text-center">
	Information Systems undergraduate at Sabaragamuwa University of Sri Lanka</br>Full Stack Developer</br>Trainee Software Engineer at 99X Technologies.
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/OmalPerera">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/OmalPerera">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:omalperera8@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/OmalPerera">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>Real-time Data Processing with Apache Kafka, Spark Streaming and Scala </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   November 
	   30th,
	   
	   2017
	 </span>
	  <div class="article_body">
	  <h3 id="should-change"><strong>**</strong><strong>**</strong>*should change</h3>
<p>Mainly we deal with the <code class="highlighter-rouge">/bin</code> folder.</p>

<ul>
  <li>for mac\t- <code class="highlighter-rouge">kafka_2.10-0.10.2.0/bin/</code></li>
  <li>for Windows - <code class="highlighter-rouge">kafka_2.10-0.10.2.0\bin\windows\</code></li>
</ul>

<h3 id="my-development-environment">My Development Environment</h3>

<ul>
  <li>Spark version 	- 2.2.0</li>
  <li>Scala version	- 2.11.11</li>
  <li>SBT version 	- 0.13.16</li>
  <li>Kafka version 	-</li>
  <li>OS 				- Mac OS (Unix based)</li>
</ul>

<p>888888888888 quote the spark is designed to work with scala 2.11.x</p>

<p><br /></p>

<h1 id="developing-the-spark-app-with-scala">Developing the Spark app with Scala</h1>
<p><br />
<strong>Note</strong> : Dependencies for this project can be definitely change with the time. And also basically those dependencies depends on the scala version, Spark version, SBT version etc that you have installed in your system. So try to stick with above mentioned development environment or else follow up the error log &amp; adjust the dependencies according to your development environment.</p>

<p><br /></p>

<p>So lets start the journey to Real-time data processing with <strong>kafka</strong> , <strong>spark</strong> , &amp; <strong>scala</strong> !</p>

<h3 id="buildsbt-file">build.sbt file</h3>

<p>As we are doing our project with SBT, here is the sbt build file <code class="highlighter-rouge">build.sbt</code> , where we include all the dependencies needed for our project.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  name :<span class="o">=</span> <span class="s2">"RealTimeDataProcessing"</span>

  version :<span class="o">=</span> <span class="s2">"0.1"</span>

  scalaVersion :<span class="o">=</span> <span class="s2">"2.11.11"</span>

  resolvers +<span class="o">=</span> <span class="s2">"Spark Packages Repo"</span> at <span class="s2">"http://dl.bintray.com/spark-packages/maven"</span>

  dependencyOverrides +<span class="o">=</span> <span class="s2">"com.fasterxml.jackson.core"</span> % <span class="s2">"jackson-core"</span> % <span class="s2">"2.8.7"</span>
  dependencyOverrides +<span class="o">=</span> <span class="s2">"com.fasterxml.jackson.core"</span> % <span class="s2">"jackson-databind"</span> % <span class="s2">"2.8.7"</span>
  dependencyOverrides +<span class="o">=</span> <span class="s2">"com.fasterxml.jackson.module"</span> % <span class="s2">"jackson-module-scala_2.11"</span> % <span class="s2">"2.8.7"</span>

  libraryDependencies +<span class="o">=</span> <span class="s2">"org.apache.spark"</span> % <span class="s2">"spark-core_2.11"</span> % <span class="s2">"2.2.0"</span>
  libraryDependencies +<span class="o">=</span> <span class="s2">"org.apache.spark"</span> % <span class="s2">"spark-sql_2.11"</span> % <span class="s2">"2.2.0"</span>
  libraryDependencies +<span class="o">=</span> <span class="s2">"org.apache.spark"</span> % <span class="s2">"spark-streaming_2.11"</span> % <span class="s2">"2.2.0"</span>
  libraryDependencies +<span class="o">=</span> <span class="s2">"org.apache.spark"</span> % <span class="s2">"spark-mllib-local_2.11"</span> % <span class="s2">"2.2.0"</span>
  libraryDependencies +<span class="o">=</span> <span class="s2">"dibbhatt"</span> % <span class="s2">"kafka-spark-consumer"</span> % <span class="s2">"1.0.12"</span>
  libraryDependencies +<span class="o">=</span> <span class="s2">"org.apache.kafka"</span> % <span class="s2">"kafka_2.11"</span> % <span class="s2">"1.0.0"</span>
  libraryDependencies +<span class="o">=</span> <span class="s2">"org.apache.spark"</span> % <span class="s2">"spark-streaming-kafka-0-8_2.11"</span> % <span class="s2">"2.1.0"</span></code></pre></figure>

<p><br /></p>

<h3 id="integrating-spark-streaming-and-apache-kafka">Integrating Spark Streaming and Apache Kafka</h3>

<p>Here we are going to fetch data from kafka topic to our spark app. if you are absoulute newbie to these area, I’m recomending you to google on <em>what is kafka?, how it works, what are kafka topics? what spark does?</em> . I’m leaving it to you as a homework.</p>

<p>So this will be the code</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">spark</span><span class="p">.</span><span class="nx">SparkConf</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">spark</span><span class="p">.</span><span class="nx">streaming</span><span class="p">.</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">KafkaUtils</span>
<span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">spark</span><span class="p">.</span><span class="nx">streaming</span><span class="p">.{</span><span class="nx">Seconds</span><span class="p">,</span> <span class="nx">StreamingContext</span><span class="p">}</span>


<span class="nx">object</span> <span class="nx">kafkaConsumer</span> <span class="p">{</span>

  <span class="nx">def</span> <span class="nx">main</span><span class="p">(</span><span class="nx">args</span><span class="err">:</span> <span class="nb">Array</span><span class="p">[</span><span class="nb">String</span><span class="p">])</span> <span class="p">{</span>

    <span class="nx">println</span><span class="p">(</span><span class="s2">"program started"</span><span class="p">)</span>

    <span class="nx">val</span> <span class="nx">conf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SparkConf</span><span class="p">().</span><span class="nx">setMaster</span><span class="p">(</span><span class="s2">"local[*]"</span><span class="p">).</span><span class="nx">setAppName</span><span class="p">(</span><span class="s2">"kafkaConsumer"</span><span class="p">)</span>

    <span class="c1">//app consumes messages every 5 seconds from kafka</span>
    <span class="nx">val</span> <span class="nx">ssc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StreamingContext</span><span class="p">(</span><span class="nx">conf</span><span class="p">,</span> <span class="nx">Seconds</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

    <span class="c1">// my kafka topic name is 'test'</span>
    <span class="nx">val</span> <span class="nx">kafkaStream</span> <span class="o">=</span> <span class="nx">KafkaUtils</span><span class="p">.</span><span class="nx">createStream</span><span class="p">(</span><span class="nx">ssc</span><span class="p">,</span> <span class="s2">"localhost:2181"</span><span class="p">,</span><span class="s2">"spark-streaming-consumer-group"</span><span class="p">,</span> <span class="nx">Map</span><span class="p">(</span><span class="s2">"test"</span> <span class="o">-&gt;</span> <span class="mi">5</span><span class="p">))</span>

    <span class="nx">kafkaStream</span><span class="p">.</span><span class="nx">print</span><span class="p">()</span>
    <span class="nx">ssc</span><span class="p">.</span><span class="nx">start</span>
    <span class="nx">ssc</span><span class="p">.</span><span class="nx">awaitTermination</span><span class="p">()</span>

  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>lets identify what the code consist of.
8
8explain the keywords
8
8
8
8
8</p>

<p>so we are now done with the spark app. prior to run our app, we have to make sure we have Up &amp; running kafka topic with name of <code class="highlighter-rouge">test</code>. If not Spark app wont be able to consume the streams.</p>

<p><br /></p>

<hr />

<p><br /></p>
<h1 id="configuring-up-kafka-broker">Configuring up Kafka broker</h1>

<p>If you dont have kafka installed in your environment, you can refer my post <a href="8888888 link 88888888">88888888888</a> to setup it from the scratch.
if you have already installed kafka, we have to create a topic named <code class="highlighter-rouge">test</code> &amp; start kafka producer.</p>

<p><br /></p>

<h3 id="starting-the-zookeeper-server">Starting the Zookeeper Server</h3>

<ul>
  <li>As you are now in the <code class="highlighter-rouge">kafka_2.10-0.10.2.0</code> directory (can be differ depends on youy kafka version), execute the following command</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  sudo bin/zookeeper-server-start.sh config/zookeeper.properties
  </code></pre></figure>

<ul>
  <li>Starting the Kafka Server</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  sudo bin/kafka-server-start.sh config/server.properties
  </code></pre></figure>

<p><br /></p>

<h3 id="creating-topic">Creating topic</h3>

<ul>
  <li>Creating a topic located at zookeeper at the <code class="highlighter-rouge">localhost:2181</code> named <code class="highlighter-rouge">test</code> with a <code class="highlighter-rouge">single partition</code> &amp; <code class="highlighter-rouge">single replica</code>. (do it in a separate terminal).</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  sudo bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic <span class="nb">test</span>
  </code></pre></figure>

<ul>
  <li>To ensure that our topic is created, execute following command</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  bin/kafka-topics.sh --list --zookeeper localhost:2181
  </code></pre></figure>

<p><br /></p>

<h3 id="running-the-producer">Running the Producer</h3>

<ul>
  <li>This is for feed the <code class="highlighter-rouge">test</code> Topic (do it in a separate console)</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  bin/kafka-console-producer.sh --broker-list localhost:9092 --topic <span class="nb">test</span>
  </code></pre></figure>

<ul>
  <li>You can send messages to the Kafka cluster from the console even except the standard file inputs. just type the message in the console. These messages will be consumed by our spark app.</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  This is a Sample message
  </code></pre></figure>

<p><br /></p>

<h3 id="running-the-consumer">Running the Consumer</h3>

<ul>
  <li>This is for listen to the producer at that port (do it in a separate terminal).</li>
  <li>Following command will listens for the topic inputs and outputs</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic <span class="nb">test</span>
    </code></pre></figure>

<ul>
  <li>If you type messages into the producer terminal you should see them appear in the consumer terminal.</li>
</ul>

<p><br /></p>

<p>Now Kafka broker is ready to go. Now its time to run our Spark application.</p>

<p><br /></p>

<hr />

<p><br /></p>
<h1 id="running-spark-application">Running Spark Application</h1>


	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#general-ref">
					general <span>(2)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#bigdata-ref">
					bigdata <span>(2)</span>
					
				</a></li>
			
		  
		</ul>
		  

		
		<ul class="list-inline">
		  <li><i class="fa fa-tags"></i></li>
		  
		  
			 
				<li>
					<a href="/tags.html#apache-ref">
					apache <span>(2)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#kafka-ref">
					kafka <span>(2)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#bigdata-ref">
					bigdata <span>(2)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#scala-ref">
					scala <span>(1)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#Real-Time-Processing-ref">
					Real-Time-Processing <span>(1)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#Spark-ref">
					Spark <span>(1)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#streaming-ref">
					streaming <span>(1)</span>
					
					</a>
				</li>
			
		  
		  
		</ul>
		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=Real-time Data Processing with Apache Kafka, Spark Streaming and Scala&via=OmalPerera"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="//www.gravatar.com/avatar/f29579eebcf0cb079c43eb37c7123235" class="img-rounded author-image" />
        <h4 class="section-title author-name">Omal Perera</h4>
        <p class="author-bio">Information Systems undergraduate at Sabaragamuwa University of Sri Lanka</br>Full Stack Developer</br>Trainee Software Engineer at 99X Technologies.</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/general/bigdata/2017/11/10/Setting-Up-Apache-Kafka-localy.html" title="Setting Up Apache Kafka locally">&larr; Previous</a></li>
		  
		  
			<li class="next disabled"><a>Next &rarr;</a>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>





		<footer>
			<hr/>
			<p>
				&copy; 2017 Omal Perera with <a href="http://jekyllrb.com/">Jekyll</a>. Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'omalperera8', 'auto');
  ga('send', 'pageview');
</script>

